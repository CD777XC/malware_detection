# Importing common libraries
import pandas as pd

# Importing preprocessing libraries functions
from sklearn.preprocessing import RobustScaler, MinMaxScaler
from sklearn.pipeline import make_pipeline
from sklearn.compose import make_column_transformer

# Loading environment variable
import os
from dotenv import load_dotenv
load_dotenv()

# Importing optimal features
from features_select import optimal_features

####################  Data Preprocessing  ####################

data = pd.read_csv(os.getenv("DATA"), sep="|")

# Defining X and y on a copy of data
X = data.drop(columns="legitimate").copy()
y = data['legitimate'].copy()

# Dropping numerical object columns
X = X.select_dtypes(exclude="object")

# Defining X features selected
X = X[optimal_features]

r_scaler_features = ['ImageBase', 'ResourcesMinSize', 'Subsystem'] # Selection done after boxplots visualization

####################  Preproc Pipeline  ####################

print(f'''{5*"#"} Building pipeline ⚙️ {5*"#"}''')

preproc_transformer = make_column_transformer(
    (RobustScaler(), r_scaler_features),
    (MinMaxScaler(), X.drop(columns=r_scaler_features).columns),
    remainder='passthrough'
)

preproc_pipe = make_pipeline(
    preproc_transformer
)

print('✅')
