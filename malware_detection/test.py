import pickle
import os
from dotenv import load_dotenv
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.metrics import precision_score

load_dotenv()

# Getting data as a CSV
data = pd.read_csv(os.getenv("DATA"), sep="|")

# Assigning X and y
X = data.drop(columns="legitimate").copy()
y = data['legitimate'].copy()

# Splitting data set
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=.2, random_state=42)

with open("malware_detection_v1.pkl", "rb") as file:
    model = pickle.load(file)

y_pred = model.predict(X_test)
precision = precision_score(y_true=y_test, y_pred=y_pred)

print(f'Score: {model.score(X_test, y_test):.4f}')
print(f'Precision: {precision:.4f}')
